---
title: "Acoso sexual callejero.AnÃƒÂ¡lisis cualitativo usando R"
author: "Elina GÃƒÂ³mez"
date: "Agosto, 2018"
output:
  ioslides_presentation: default
  beamer_presentation: default
  slidy_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Contexto

El presente análisis se desarrolla en el marco del __estudio diagnóstico sobre el acoso sexual y otros tipos de violencia contra las mujeres y niñas en espacios públicos__ en Montevideo. El mismo se enmarca en un convenio suscripto entre ONU Mujeres, la Asesoría para Igualdad de Género de la Intendencia de Montevideo (IM) y la Facultad de Ciencias Sociales (UdelaR).

##Definiciones

El estudio concibe al Acoso Sexual Callejero (ASC) como:

_"Incluye comentarios, atención, acciones o gestos con contenido sexual indeseado. Como en
otras formas de violencia sexual, el componente clave del acoso sexual es que alguien
realiza una acción sin el consentimiento, permiso o acuerdo de la persona o personas a las
que se dirige. Acoso sexual incluye formas sin contacto, como comentarios sexuales acerca
del cuerpo o apariencia de la persona, silbidos mientras pasa una mujer, exigencias de
favores sexuales, quedarse mirando de manera sexualmente sugestiva, persecuciones y
seguimiento de una persona, exposición de órganos sexuales. El acoso sexual también
incluye formas físicas de contacto, como frotarse intencionalmente contra alguien en la
calle o en el transporte público, agarrar, pegar una palmada y aproximarse a alguien en una
manera sexual." (ONU Mujeres, 2013)_


## Objetivos

- Realizar un análisis textual de grupos de discusión sobre ASC realizados a mujeres y varones.


- Analizar los datos surgidos de un Paper Review sobre la temática.


#I. Análisis textual

```{r cargodatos, message=FALSE, warning=FALSE, include=FALSE}
## seteo
setwd("C:/Users/Elina/Desktop/Trabajo/R/RLadies")

library(devtools)
require(quanteda)
library(readtext)
library(stringr)

mytf<-readtext("grupos_acoso/*", docvarsfrom ="filenames")
myCorpus<-corpus(mytf,text_field="text")
mydfm <- dfm(myCorpus)
##abro un archivo con stopwords
stop=read.csv("stopes.csv",sep=";")
vector=as.character(stop$X0)
mydfm <- dfm(myCorpus,
             stem = FALSE,
             tolower = TRUE,
             remove = c(stopwords("spanish"),vector), 
             remove_punct = TRUE, 
             remove_numbers = TRUE, 
             verbose = TRUE)
words<-featnames(mydfm)
#Saco palabras con 1 y 2 caracteres
words_Length_1<-words[sapply(words,str_length)==1]
words_Length_2<-words[sapply(words,str_length)==2]
otherWords<-c("risas",words_Length_1,words_Length_2) 
mydfm<-dfm(mydfm,remove=otherWords)
```

## Datos existentes

- 6 grupos de discusión sobre la temática ASC, en los cuales participaron mujeres y varones de Montevideo, pertenecientes a diferentes tramos etarios:


|         | Mujeres | Varones|Total
| :-----: |:-------:| :-----:|:-----:|
| Jovenes | 3       | 1      |4      |
| Adultos | 1       | 1      |2      |
| Total   | 4       | 2      |6      |


##Pre-procesamiento

- Abro los archivos de texto en los cuales tengo las transcripciones de los grupos
- Elimino aquellas menciones que corresponden a lxs moderadorxs 
- Guardo como archivos .txt, identificando cada archivo por su nombre según las carcaterísticas del grupo (variables de agrupación posteriores)

##Pre-procesamiento

- Abro los archivos con la función **readtext()**, especificando ubicación de los mismos y variables anexas en los títulos para identificar características del documento

![](readtext.png)

##Pre-procesamiento

- Creo un **corpus** con el paquete **quanteda** 

![](corpus.png)


<!-- ##Pre-procesamiento -->

<!-- ```{r corpus, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE,size="tiny"} -->
<!-- summary(myCorpus) -->
<!-- ``` -->


##_"Limpieza"_ del texto


- Creo un Document feature matrix (DFM), aplicando algunos argumentos que me permiten limpiar las palabras que no me interesan al efecto del análisis. 
    - Homogeinizo las palabras en minúscula
    - Elimino números
    - Elimino puntuaciones 
    - Elimno stopwords (por defecto y lista propia)
    - Elimino palabras con pocos caracteres (1 y 2)
    - Elimino palabras específicas que no me interesan (ej. "Risas")
    
#Nubes de palabras
##Nubes de palabras: general


```{r wcgeneral, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE,fig.height = 10, fig.width = 10, fig.align = "center",out.width = "150%"}
 textplot_wordcloud(mydfm, min.count = 3,max_words = 200,random.order = FALSE,
                    rot.per = .25, 
                    colors = RColorBrewer::brewer.pal(8,"Dark2"))
```



##Nubes de palabras: grupos

```{r wccomp, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
rownames(mydfm)=c("Mujeres adultas","Mujeres jóvenes","Mujeres jóvenes","Mujeres jóvenes","Varones adultos","Varones jovenes")
# Nube de palabras: comparado
textplot_wordcloud(mydfm, min.count = 3,max_words = 500,random.order = FALSE,
                   rot.per = .25, 
                   colors = RColorBrewer::brewer.pal(8,"Dark2"),comparison = T)
```

##Nubes de palabras: mujeres/varones

```{r wccomp2, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
dfm_sexo <- dfm(mydfm, groups = "docvar1")
textplot_wordcloud(dfm_sexo, min.count = 2,max_words = 200,random.order = FALSE,
                   rot.per = .25, 
                   colors = RColorBrewer::brewer.pal(8,"Dark2"),comparison = T)
```

##Nube de palabras: adultos/jovenes

```{r wccomp3, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
dfm_edad <- dfm(mydfm, groups = "docvar2")
textplot_wordcloud(dfm_edad, min.count = 2,max_words = 200,random.order = FALSE,
                   rot.per = .25, 
                   colors = RColorBrewer::brewer.pal(8,"Dark2"),comparison = T)
```

##Palabras más frecuentes: general

```{r frec1, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
coloree=c(rep("#D7B5D8",20))
library(ggplot2)
topacoso=data.frame(topfeatures(mydfm,20))
topacoso$palabra=rownames(topacoso)
acosopplot=topacoso[1:20, ] %>%
ggplot( aes(x = reorder(palabra,topfeatures.mydfm..20.), y = topfeatures.mydfm..20., fill = palabra)) + 
geom_col(show.legend = FALSE) +
coord_flip() +
geom_text(aes(hjust = -0.1, label = topfeatures.mydfm..20.)) +
theme_minimal() +
theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15)) +
ggtitle("Palabras más frecuentes (n=15)")+
  scale_fill_manual(values=coloree)
acosopplot
```
 
##Palabras más frecuentes: mujeres/varones

```{r frec2, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(gridExtra)
color=c(rep("#D7B5D8",20))
mydfm_mujer <- corpus_subset(myCorpus, docvar1 == "Mujeres")  
mydfm_mujer <- dfm(mydfm_mujer,
             stem = FALSE,
             tolower = TRUE,
             remove = c(stopwords("spanish"),vector), 
             remove_punct = TRUE, 
             remove_numbers = TRUE, 
             verbose = TRUE)
words<-featnames(mydfm_mujer)
#Saco palabras con 1 y 2 caracteres
words_Length_1<-words[sapply(words,str_length)==1]
words_Length_2<-words[sapply(words,str_length)==2]
otherWords<-c("risas",words_Length_1,words_Length_2) #you can expand this list
mydfm_mujer<-dfm(mydfm_mujer,remove=otherWords)
topacoso_mujer=data.frame(topfeatures(mydfm_mujer,20))
topacoso_mujer$palabra=rownames(topacoso_mujer)
acosopplot_mujer=topacoso_mujer[1:20, ] %>%
  ggplot( aes(x = reorder(palabra,topfeatures.mydfm_mujer..20.), y = topfeatures.mydfm_mujer..20., fill = palabra)) + 
  geom_col(show.legend = FALSE) +
  coord_flip() +
  geom_text(aes(hjust = -0.1, label = topfeatures.mydfm_mujer..20.)) +
  theme_minimal() +
  theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15)) +
  ggtitle("Palabras más frecuentes: Mujeres (n=20)")+
  scale_fill_manual(values=color)
mydfm_varon <- corpus_subset(myCorpus, docvar1 == "Varones")  
mydfm_varon <- dfm(mydfm_varon,
                   stem = FALSE,
                   tolower = TRUE,
                   remove = c(stopwords("spanish"),vector), 
                   remove_punct = TRUE, 
                   remove_numbers = TRUE, 
                   verbose = TRUE)
words<-featnames(mydfm_varon)
#Saco palabras con 1 y 2 caracteres
words_Length_1<-words[sapply(words,str_length)==1]
words_Length_2<-words[sapply(words,str_length)==2]
otherWords<-c("risas",words_Length_1,words_Length_2) #you can expand this list
mydfm_varon<-dfm(mydfm_varon,remove=otherWords)
topacoso_varon=data.frame(topfeatures(mydfm_varon,20))
topacoso_varon$palabra=rownames(topacoso_varon)
acosopplot_varon=topacoso_varon[1:20, ] %>%
  ggplot( aes(x = reorder(palabra,topfeatures.mydfm_varon..20.), y = topfeatures.mydfm_varon..20., fill = palabra)) + 
  geom_col(show.legend = FALSE) +
  coord_flip() +
  geom_text(aes(hjust = -0.1, label = topfeatures.mydfm_varon..20.)) +
  theme_minimal() +
  theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15)) +
  ggtitle("Palabras más frecuentes: Varones (n=20)")+
  scale_fill_manual(values=color)
grid.arrange(acosopplot_mujer, acosopplot_varon, ncol = 2, heights = c(5, 0.30))
```

#Agrupación de palabras
##Agrupación de palabras

- Para dar cuenta de la agrupación de palabras, uso el paquete **tm** y, a diferencia del análisis anterior, considero cada mención como un elemento del corpus
- Calculo las distancias entre los términos y armo _clusters_ de palabras (método euclidiano)
- Grafico la agrupación jerárquica de las palabras en un dendograma, separada entre grupos (método de Ward)

##Agrupación de palabras: mujeres

```{r dendo_m, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(tm)
#mujeres
mujeres=read.csv("CSV/men_mujeres.csv",sep=";",header = T)
corpus_men_mujeres <- Corpus(VectorSource(mujeres$Texto),readerControl = list(encoding = "UTF-8",language="es"))
corpus_men_mujeres <- tm_map(corpus_men_mujeres, content_transformer(tolower))
corpus_men_mujeres <- tm_map(corpus_men_mujeres, removeNumbers)
corpus_men_mujeres <- tm_map(corpus_men_mujeres, removePunctuation)
corpus_men_mujeres <- tm_map(corpus_men_mujeres, removeWords, vector)
corpus_men_mujeres_tdm=TermDocumentMatrix(corpus_men_mujeres, control = list(encoding = "UTF-8",reader=readPlain,language="es"))
corpus_men_mujeres_mat <- as.matrix(corpus_men_mujeres_tdm)
corpus_men_mujeres_mat <- corpus_men_mujeres_mat %>% rowSums() %>% sort(decreasing = TRUE)
corpus_men_mujeres_mat <- data.frame(palabra = names(corpus_men_mujeres_mat), frec = corpus_men_mujeres_mat)
corpus_men_mujeres_tdm_nuevo <- removeSparseTerms(corpus_men_mujeres_tdm, sparse = .985)
corpus_men_mujeres_tdm_nuevo <- corpus_men_mujeres_tdm_nuevo %>% as.matrix()
corpus_men_mujeres_tdm_nuevo <- corpus_men_mujeres_tdm_nuevo / rowSums(corpus_men_mujeres_tdm_nuevo)
corpus_men_mujeres_tdm_nuevo_dist <- dist(corpus_men_mujeres_tdm_nuevo, method = "euclidian")
corpus_men_mujeres_tdm_nuevo_hclust <-  hclust(corpus_men_mujeres_tdm_nuevo_dist, method = "ward.D")
plot(corpus_men_mujeres_tdm_nuevo_hclust, main = "Dendrograma - Mujeres", sub = "", xlab = "")
```


##Agrupación de palabras: varones

```{r dendo_v, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
varones=read.csv("CSV/men_varones.csv",sep=";",header = T)
corpus_men_varones <- Corpus(VectorSource(varones$Texto),readerControl = list(encoding = "UTF-8",language="es"))
corpus_men_varones <- tm_map(corpus_men_varones, content_transformer(tolower))
corpus_men_varones <- tm_map(corpus_men_varones, removeNumbers)
corpus_men_varones <- tm_map(corpus_men_varones, removePunctuation)
corpus_men_varones <- tm_map(corpus_men_varones, removeWords, vector)
corpus_men_varones_tdm=TermDocumentMatrix(corpus_men_varones, control = list(encoding = "UTF-8",reader=readPlain,language="es"))
corpus_men_varones_mat <- as.matrix(corpus_men_varones_tdm)
corpus_men_varones_mat <- corpus_men_varones_mat %>% rowSums() %>% sort(decreasing = TRUE)
corpus_men_varones_mat <- data.frame(palabra = names(corpus_men_varones_mat), frec = corpus_men_varones_mat)
corpus_men_varones_tdm_nuevo <- removeSparseTerms(corpus_men_varones_tdm, sparse = .97)
corpus_men_varones_tdm_nuevo <- corpus_men_varones_tdm_nuevo %>% as.matrix()
corpus_men_varones_tdm_nuevo <- corpus_men_varones_tdm_nuevo / rowSums(corpus_men_varones_tdm_nuevo)
corpus_men_varones_tdm_nuevo_dist <- dist(corpus_men_varones_tdm_nuevo, method = "euclidian")
corpus_men_varones_tdm_nuevo_hclust <-  hclust(corpus_men_varones_tdm_nuevo_dist, method = "ward.D")
plot(corpus_men_varones_tdm_nuevo_hclust, main = "Dendrograma - Varones", sub = "", xlab = "")
```

#Asociación de palabras
##Asociación de palabras

- Para analizar las asociaciones entre palabras, consideramos una dispersión de 0.995 
- Buscamos la asociación de palabras, considerando una correlación mínima de 0.05
- Al tratarse de menciones y no de grupos, la dispersión entre términos es muy alta
- Analizamos la asociación con las palabras: _calle_, _acoso_ y _mujer_

##Asociaciónde palabras: $calle

```{r asoc_calle, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
colores=c(rep("#D7B5D8",5))
corpus_men_mujeres_tdm_2 <- removeSparseTerms(corpus_men_mujeres_tdm, sparse = .995)
corpus_men_varones_tdm_2 <- removeSparseTerms(corpus_men_varones_tdm, sparse = .995)
#$calle
calle_mujer=as.data.frame(findAssocs(corpus_men_mujeres_tdm_2, terms = c("calle"), corlimit = .05))
calle_mujer$palabra=rownames(calle_mujer)
plotcalle_mujer=calle_mujer[c(3,6,8,9,10), ] %>%
  ggplot( aes(x = reorder(palabra, calle), y = calle, fill = palabra)) + 
  geom_col(show.legend = FALSE) +
  coord_flip() +
  geom_text(aes(hjust = -0.1, label = calle)) +
  theme_minimal() +
  theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15)) +
  ggtitle("Asociación con $calle en mujeres (n=5,liminf=0.05)")+
  scale_fill_manual(values=colores)

calle_varon=as.data.frame(findAssocs(corpus_men_varones_tdm_2, terms = c("calle"), corlimit = .05))
calle_varon$palabra=rownames(calle_varon)
plotcalle_varon=calle_varon[c(1,7,9,11,13), ] %>%
  ggplot( aes(x = reorder(palabra, calle), y = calle, fill = palabra)) + 
  geom_col(show.legend = FALSE) +
  coord_flip() +
  geom_text(aes(hjust = -0.1, label = calle)) +
  theme_minimal() +
  theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15)) +
  ggtitle("Asociación con $calle en varones (n=5,liminf=0.05)")+
  scale_fill_manual(values=colores)
grid.arrange(plotcalle_mujer, plotcalle_varon, ncol = 2, heights = c(1, 0))
```

##Asociación de palabras: $acoso

```{r asoc_acoso, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE }
acoso_mujer=as.data.frame(findAssocs(corpus_men_mujeres_tdm_2, terms = c("acoso"), corlimit = .05))
acoso_mujer$palabra=rownames(acoso_mujer)
plotacoso_mujer=acoso_mujer[c(1,5,8,13,14), ] %>%
  ggplot( aes(x = reorder(palabra, acoso), y = acoso, fill = palabra)) + 
  geom_col(show.legend = FALSE) +
  coord_flip() +
  geom_text(aes(hjust = -0.1, label = acoso)) +
  theme_minimal() +
  theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15)) +
  ggtitle("Asociación con $acoso en mujeres (n=5,liminf=0.05)")+
  scale_fill_manual(values=colores)

acoso_varon=as.data.frame(findAssocs(corpus_men_varones_tdm_2, terms = c("acoso"), corlimit = .05))
acoso_varon$palabra=rownames(acoso_varon)
plotacoso_varon=acoso_varon[c(1,7,9,10,15), ] %>%
  ggplot( aes(x = reorder(palabra, acoso), y = acoso, fill = palabra)) + 
  geom_col(show.legend = FALSE) +
  coord_flip() +
  geom_text(aes(hjust = -0.1, label = acoso)) +
  theme_minimal() +
  theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15)) +
  ggtitle("Asociación con $acoso en varones (n=5,liminf=0.05)")+
  scale_fill_manual(values=colores)

grid.arrange(plotacoso_mujer, plotacoso_varon, ncol = 2, heights = c(1, 0))

```


##Asociaciónde palabras: $mujer

```{r asoc_mujer, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

mujer_mujer=as.data.frame(findAssocs(corpus_men_mujeres_tdm_2, terms = c("mujer"), corlimit = .05))
mujer_mujer$palabra=rownames(mujer_mujer)
plotmujer_mujer=mujer_mujer[c(2,3,8,14,15), ] %>%
  ggplot( aes(x = reorder(palabra, mujer), y = mujer, fill = palabra)) + 
  geom_col(show.legend = FALSE) +
  coord_flip() +
  geom_text(aes(hjust = -0.1, label = mujer)) +
  theme_minimal() +
  theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15)) +
  ggtitle("Asociación con $mujer en mujeres (n=5,liminf=0.05)")+
  scale_fill_manual(values=colores)

mujer_varon=as.data.frame(findAssocs(corpus_men_varones_tdm_2, terms = c("mujer"), corlimit = .05))
mujer_varon$palabra=rownames(mujer_varon)
plotmujer_varon=mujer_varon[c(3,5,7,9,1), ] %>%
  ggplot( aes(x = reorder(palabra, mujer), y = mujer, fill = palabra)) + 
  geom_col(show.legend = FALSE) +
  coord_flip() +
  geom_text(aes(hjust = -0.1, label = mujer)) +
  theme_minimal() +
  theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15)) +
  ggtitle("Asociación con $mujer en varones (n=5,liminf=0.05)")+
  scale_fill_manual(values=colores)

grid.arrange(plotmujer_mujer, plotmujer_varon, ncol = 2, heights = c(1, 0))

```

#Análisis de sentimiento


##Análisis de sentimiento

Se presentan dos métodos para analizar sentimiento de los documentos:

- Diccionario LWIC-Spanish: con la función dfm_lookup() de _quanteda_ identifica en los documentos las emociones presentes en el diccionario y establece puntajes para cada uno, a partir de la estandarización de los mismos (conicidencia únicamente de 15% entre términos).   

- Método Syuzhet: utiliza la función get_sentiment() de _syuzhet_ asigna puntajes a cada documento según el método y lenguaje indicado. El método **syuzhet** es un diccionario de sentimientos desarrollado en el Laboratorio Literario de Nebraska. Otros métodos: _bing_, _afinn_, _nrc_ y _stanford_. 



##Análisis de sentimiento

Comparación entre los métodos:

![](metodos.pdf)

##Análisis de sentimiento

```{r sentm, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(dplyr)
afinn <- read.csv("lexico_afinn.en.es.csv", stringsAsFactors = F, fileEncoding = "latin1") %>% 
  tbl_df()
afinn$sentimiento=ifelse(afinn$Puntuacion > 0, "Positiva", "Negativa")
corpus_men_mujeres_mat$palabra=as.character(corpus_men_mujeres_mat$palabra)
corpus_men_mujeres_mat %>%  
  inner_join(afinn, by = c("palabra" = "Palabra")) %>%
  count(palabra, sentimiento, sort = TRUE) %>%
  ungroup() %>%
  group_by(sentimiento) %>%
  top_n(12) %>%
  ungroup() %>%
  mutate(palabra = reorder(palabra, n)) %>%
  ggplot(aes(palabra, n, fill = sentimiento)) +
  geom_col(show.legend = F) +
  facet_wrap(~sentimiento, scales = "free_y") +
  labs(y = NULL, x = NULL) +
  coord_flip() +
  ggtitle("Sentimientos más extremos - Mujeres") +
  theme_minimal()+
  theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15))+
  scale_fill_manual(values=c('#fcbbb6' ,"#64ffa0")) 

```

##Análisis de sentimiento

```{r sentv, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
corpus_men_varones_mat$palabra=as.character(corpus_men_varones_mat$palabra)
corpus_men_varones_mat %>%  
  inner_join(afinn, by = c("palabra" = "Palabra")) %>%
  count(palabra, sentimiento, sort = TRUE) %>%
  ungroup() %>%
  group_by(sentimiento) %>%
  top_n(8) %>%
  ungroup() %>%
  mutate(palabra = reorder(palabra, n)) %>%
  ggplot(aes(palabra, n, fill = sentimiento)) +
  geom_col(show.legend = F) +
  facet_wrap(~sentimiento, scales = "free_y") +
  labs(y = NULL, x = NULL) +
  coord_flip() +
  ggtitle("Sentimientos más extremos - Varones") +
  theme_minimal()+
  theme(axis.title.y =element_blank() , axis.title.x =element_blank(),axis.text = element_text(size = 15))+
  scale_fill_manual(values=c('#fcbbb6' ,"#64ffa0"))  

```


#II. Paper review



##Paper review

- A partir de la sistematización de los trabajos los diversos tipos de documentos hallados, se construyó un catálogo con 202 trabajos académicos de distinta índole, a saber: artículos arbitrados, ensayos, reportes, informes, monografías, ponencias, libros, que abarcan variedad de países y regiones dentro de los cinco continentes. 


##Sexo

-  Al separar por sexo la autoría de los trabajos, se destaca que las mujeres investigan casi cinco veces más que los varones en la temática

```{r prsexo, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE,fig.width=11,fig.height=6}

pr=read.csv("PR/base_pr.csv",sep=";",header = T)
##sexo y año
sexo=subset(pr,pr$Sexo!="")
sexo=data.frame(table(sexo$Año,sexo$Sexo))
sexo=subset(sexo,sexo$Freq!=0)
tot=data.frame(table(pr$Año))
tot$Var1=as.numeric(as.character(tot$Var1))
tot$Var2="Total"
tot=tot[,c("Var1","Var2","Freq")]
tot=rbind(sexo,tot)
tot$Var1=as.numeric(as.character(tot$Var1))
gg <- ggplot(tot, aes(x=Var1)) 
gg + geom_line(aes(y=Freq, color=Var2), size=1.2) + scale_color_discrete(name="")+
  ggtitle("Cantidad de publicaciones por sexo (1971-2018)")+
  theme(axis.title.y =element_blank() , axis.title.x =element_blank()) 

```

##Región

- De los trabajos relevados casi seis de cada diez son escritos en español, y de estos un 70 % han sido producidos en Latinoamérica.

- Antes de 2008 la producción era casi exclusivamente en inglés, y a partir de esa fecha se potencia la investigación y acumulación en América Latina. 


##Región

```{r prregion, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE,fig.width=15,fig.height=10}
reciente=subset(pr,pr$Año>2000&pr$Año<2018)
cont=data.frame(table(reciente$Año,reciente$Región))
#sexo=subset(sexo,sexo$Freq!=0)
cont$Var1=as.numeric(as.character(cont$Var1))
gg <- ggplot(cont, aes(x=Var1)) 
gg + geom_line(aes(y=Freq, color=Var2), size=1.2) + scale_color_discrete(name="")+
  ggtitle("Cantidad de publicaciones por región (2000-2017)")+
  theme(axis.title.y =element_blank() , axis.title.x =element_blank()) 

```

##Análisis de títulos: décadas

```{r titpr, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
dec_80=read.csv("PR/80´.csv",sep=";",header = T)
dec_90=read.csv("PR/90´.csv",sep=";",header = T)
dec_00=read.csv("PR/00´.csv",sep=";",header = T)
dec_10=read.csv("PR/10´.csv",sep=";",header = T)
dec_80=toString(dec_80[,1])
dec_90=toString(dec_90[,1])
dec_00=toString(dec_00[,1])
dec_10=toString(dec_10[,1])
writeLines(dec_80, "PR/TXT/80´.txt")
writeLines(dec_90, "PR/TXT/90´.txt")
writeLines(dec_00, "PR/TXT/00´.txt")
writeLines(dec_10, "PR/TXT/10´.txt")

mytf_pr<-readtext("PR/TXT/*", docvarsfrom ="filenames")
myCorpus_pr<-corpus(mytf_pr,text_field="text")
mydfm_PR <- dfm(myCorpus_pr,
             stem = FALSE,
             tolower = TRUE,
             remove = c(stopwords("spanish"),vector), 
             remove_punct = TRUE, 
             remove_numbers = TRUE, 
             verbose = TRUE)
words<-featnames(mydfm_PR)
#Saco palabras con 1 y 2 caracteres
words_Length_1<-words[sapply(words,str_length)==1]
words_Length_2<-words[sapply(words,str_length)==2]
otherWords<-c("hey",words_Length_1,words_Length_2) #you can expand this list
mydfm_PR<-dfm(mydfm_PR,remove=otherWords)

rownames(mydfm_PR)=c("00´","10´","80´","90´")
# Nube de palabras: comparado
textplot_wordcloud(mydfm_PR, min.count = 2,max_words = 500,random.order = FALSE,
                   rot.per = .25, 
                   colors = RColorBrewer::brewer.pal(8,"Dark2"),comparison = T,min_size = 2,max_size = 3)

```

##Dendograma

```{r dendo_pr, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
tit_pr=read.csv("PR/base_pr.csv",sep=";",header = T)
corpus_tit_pr <- Corpus(VectorSource(tit_pr$TITESP),readerControl = list(encoding = "UTF-8",language="es"))
corpus_tit_pr <- tm_map(corpus_tit_pr, content_transformer(tolower))
corpus_tit_pr <- tm_map(corpus_tit_pr, removeNumbers)
corpus_tit_pr <- tm_map(corpus_tit_pr, removePunctuation)
corpus_tit_pr <- tm_map(corpus_tit_pr, removeWords, vector)
corpus_tit_pr <- tm_map(corpus_tit_pr, stemDocument,"spanish")
corpus_tit_pr_tdm=TermDocumentMatrix(corpus_tit_pr, control = list(encoding = "UTF-8",reader=readPlain,language="es"))
corpus_tit_pr_tdm <- removeSparseTerms(corpus_tit_pr_tdm, sparse = .97)
#corpus_tit_pr_mat <- as.matrix(corpus_tit_pr_tdm)
corpus_tit_pr_tdm <- corpus_tit_pr_tdm %>% as.matrix()
corpus_tit_pr_tdm <- corpus_tit_pr_tdm / rowSums(corpus_tit_pr_tdm)
corpus_tit_pr_tdm_dist <- dist(corpus_tit_pr_tdm, method = "euclidian")
corpus_tit_pr_tdm_hclust <-  hclust(corpus_tit_pr_tdm_dist, method = "ward.D")
plot(corpus_tit_pr_tdm_hclust, main = "Dendrograma - Paper Review", sub = "", xlab = "")
rect.hclust(corpus_tit_pr_tdm_hclust, k = 6, border="blue")
```

##


                    Muchas gracias!!



